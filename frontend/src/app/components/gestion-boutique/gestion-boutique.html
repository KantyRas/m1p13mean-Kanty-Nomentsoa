<div class="gestion-container">

  <!-- FILTRE -->
  <div class="filter">
    <button (click)="loadBoutiques()">Toutes</button>
    <button (click)="filterByStatut(0)">Libres</button>
    <button (click)="filterByStatut(1)">Occupées</button>
  </div>

  <!-- FORMULAIRE -->
  <div class="form-section">
    <h2>{{ selectedBoutique ? 'Modifier Boutique' : 'Créer Boutique' }}</h2>

    <form (ngSubmit)="selectedBoutique ? updateBoutique() : createBoutique()">

      <input type="text" placeholder="Référence"
             [(ngModel)]="boutiqueForm.reference" name="reference">

      <input type="text" placeholder="Nom boutique"
             [(ngModel)]="boutiqueForm.nomboutique" name="nomboutique" required>

      <input type="text" placeholder="Description"
             [(ngModel)]="boutiqueForm.description" name="description">

      <input type="number" placeholder="Surface"
             [(ngModel)]="boutiqueForm.surface" name="surface" min="0" required>

      <input type="number" placeholder="Loyer"
             [(ngModel)]="boutiqueForm.loyer" name="loyer" min="0" required>

      <input type="number" placeholder="Nombre pièces"
             [(ngModel)]="boutiqueForm.nombrepiece" name="nombrepiece" min="0" required>

      <input type="text" placeholder="Localisation"
             [(ngModel)]="boutiqueForm.localisation" name="localisation">

      <select *ngIf="isEditing" [(ngModel)]="boutiqueForm.statut" name="statut">
        <option [ngValue]="0">Libre</option>
        <option [ngValue]="1">Occupée</option>
      </select>

      <div class="form-buttons">
        <button type="submit">
          {{ selectedBoutique ? 'Mettre à jour' : 'Créer' }}
        </button>

        <button type="button" *ngIf="selectedBoutique" (click)="resetForm()">
          Annuler
        </button>
      </div>

    </form>
  </div>

  <!-- TABLE LISTE -->
  <div class="table-section">
    <h2>Liste des boutiques</h2>

    <table>
      <thead>
      <tr>
        <th>Réf</th>
        <th>Nom</th>
        <th>Déscription</th>
        <th>Nb.pièces</th>
        <th>Surface</th>
        <th>Loyer</th>
        <th>Statut</th>
        <th>Actions</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let b of boutiques">
        <td>{{ b.reference }}</td>
        <td>{{ b.nomboutique }}</td>
        <td>{{ b.description }}</td>
        <td>{{ b.nombrepiece }}</td>
        <td>{{ b.surface }} m²</td>
        <td>{{ b.loyer }} Ar</td>
        <td>
            <span [ngClass]="b.statut === 0 ? 'badge-libre' : 'badge-occupee'">
              {{ b.statut === 0 ? 'Libre' : 'Occupée' }}
            </span>
        </td>
        <td>
          <button (click)="showDetails(b)">Détails</button>
          <button (click)="editBoutique(b)">Modifier</button>
          <button (click)="deleteBoutique(b._id)">Supprimer</button>
        </td>
      </tr>
      </tbody>
    </table>

  </div>

</div>

<!-- MODAL DETAILS -->
<div class="modal-backdrop" *ngIf="showDetailsModal">

  <div class="modal">

    <h2>Détails Boutique</h2>

    <label>Propriétaire</label>
    <select [(ngModel)]="detailsForm.proprietaire" name="proprietaire">
      <option *ngFor="let user of users" [value]="user._id">
        {{ user.name }}
      </option>
    </select>

    <label>Catégorie</label>
    <input type="text"
           [(ngModel)]="detailsForm.categorie"
           name="categorie">

    <div class="modal-buttons">
      <button (click)="saveDetails()">Enregistrer</button>
      <button (click)="showDetailsModal=false">Annuler</button>
    </div>

  </div>
</div>

<!-- MODAL DÉTAILS -->
<div class="modal-backdrop" *ngIf="detailsModalVisible">
  <div class="modal">
    <h2>Détails de la boutique</h2>

    <p><strong>Propriétaire actuel:</strong>
      {{ selectedDetails.proprietaire?.name || 'Non défini' }}
    </p>

    <p><strong>Catégorie :</strong>
      {{ selectedDetails.categorie || 'Non défini' }}
    </p>

    <p><strong>Date activation :</strong>
      {{ selectedDetails.date_activation ? (selectedDetails.date_activation | date:'short') : 'Non définie' }}
    </p>

    <p><strong>Date resilliation :</strong>
      {{ selectedDetails.date_resilliation ? (selectedDetails.date_activation | date:'short') : 'Non définie' }}
    </p>

    <div class="modal-buttons">
      <button (click)="closeDetails()">Fermer</button>
    </div>
  </div>
</div>
